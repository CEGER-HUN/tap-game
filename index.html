<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modern Clicker Game</title>
    <style>
        :root {
            --primary: #ffd700;
            --secondary: #a855f7;
            --accent: #ec4899;
            --text: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle at center, #1a1a2e 0%, #0a0a0f 100%);
            color: var(--text);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 14px 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        /* HEADER */
        header { text-align: center; flex-shrink: 0; }

        #score {
            font-size: 2.8rem;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            line-height: 1.1;
        }

        .sub-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 2px; }

        .income-row {
            font-size: 0.75rem;
            color: #ffd700;
            margin-top: 3px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .mini-bar {
            margin-top: 5px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .bar-track { height: 7px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; }
        .bar-fill { height:100%; border-radius:10px; width:0%; transition: width 0.3s; }
        .bar-fill.xp { background: linear-gradient(90deg, var(--secondary), var(--accent)); }
        .bar-fill.energy { background: linear-gradient(90deg, #00ff88, #00d9ff); width:100%; }

        .bar-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.68rem;
            margin-bottom: 3px;
            font-weight: bold;
        }

        /* MAIN */
        main {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0 4px;
        }

        .combo-container { width:120px; text-align:center; margin-bottom:4px; height:18px; }

        #combo-text { font-size:0.78rem; font-weight:900; color:var(--accent); opacity:0; transition:opacity 0.2s; }

        .combo-bar { height:3px; background:rgba(0,0,0,0.3); border-radius:10px; overflow:hidden; margin-top:2px; }
        #combo-fill { height:100%; width:0%; background:var(--accent); box-shadow:0 0 6px var(--accent); transition:width 0.1s; }

        #coin-container { position:relative; cursor:pointer; touch-action:manipulation; }

        #main-coin {
            font-size: 100px;
            filter: drop-shadow(0 0 18px rgba(255,215,0,0.25));
            animation: float 3s infinite ease-in-out;
            line-height: 1;
        }

        #coin-container:active #main-coin { transform:scale(0.85) !important; animation:none; }
        .coin-disabled #main-coin { filter:grayscale(1) drop-shadow(0 0 8px rgba(100,100,100,0.3)); animation:none; }

        @keyframes float {
            0%,100% { transform:translateY(0); }
            50% { transform:translateY(-7px); }
        }

        .collect-row { margin-top:6px; display:flex; justify-content:center; }

        .collect-btn {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border:none; color:#1a1a2e; padding:6px 14px;
            border-radius:9px; font-size:0.74rem; font-weight:900;
            cursor:pointer; transition:0.15s;
        }
        .collect-btn:active { transform:scale(0.93); }
        .collect-btn.waiting { background:rgba(255,255,255,0.07); color:#aaa; cursor:not-allowed; pointer-events:none; }

        /* FLOATING */
        .floating-text {
            position:fixed; color:var(--primary); font-weight:bold; font-size:1.2rem;
            pointer-events:none; animation:floatUp 0.8s forwards; z-index:1000;
            text-shadow:0 0 6px rgba(255,215,0,0.5);
        }
        @keyframes floatUp { from{opacity:1;transform:translateY(0)} to{opacity:0;transform:translateY(-90px)} }

        /* BOTTOM NAV BAR */
        .bottom-nav {
            flex-shrink:0;
            margin-top: auto;
            padding-top: 10px;
        }

        .open-shop-btn {
            width:100%;
            background: linear-gradient(135deg, rgba(168,85,247,0.25), rgba(168,85,247,0.1));
            border: 1px solid rgba(168,85,247,0.45);
            border-radius: 14px;
            padding: 13px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: 0.15s;
        }
        .open-shop-btn:active { transform:scale(0.97); background:rgba(168,85,247,0.3); }

        .shop-btn-left { display:flex; align-items:center; gap:12px; }
        .shop-btn-icon { font-size:1.6rem; }
        .shop-btn-text { display:flex; flex-direction:column; text-align:left; }
        .shop-btn-title { font-size:0.88rem; font-weight:800; color:#fff; letter-spacing:0.3px; }
        .shop-btn-sub { font-size:0.68rem; color:#888; margin-top:1px; }

        .shop-btn-right { display:flex; align-items:center; gap:8px; }
        .shop-btn-badge {
            background: var(--secondary);
            color:#fff; font-size:0.62rem; font-weight:800;
            padding:2px 7px; border-radius:20px;
        }
        .shop-btn-arrow { color:rgba(168,85,247,0.7); font-size:1.1rem; }

        /* ===== BOTTOM SHEET (Kart Sayfasƒ±) ===== */
        .sheet-overlay {
            position:fixed; inset:0;
            background:rgba(0,0,0,0.55);
            z-index:500;
            opacity:0; pointer-events:none;
            transition: opacity 0.25s;
        }
        .sheet-overlay.open { opacity:1; pointer-events:auto; }

        .sheet {
            position:fixed;
            bottom:0; left:50%; transform:translateX(-50%) translateY(100%);
            width:100%; max-width:450px;
            background: #12121f;
            border-radius: 22px 22px 0 0;
            border-top: 1px solid rgba(255,255,255,0.1);
            height: 85vh;
            display:flex; flex-direction:column;
            z-index:501;
            transition: transform 0.3s cubic-bezier(0.32,0.72,0,1);
            overflow:hidden;
        }
        .sheet.open { transform:translateX(-50%) translateY(0); }

        /* Sheet handle */
        .sheet-handle {
            width:40px; height:4px; background:rgba(255,255,255,0.2);
            border-radius:3px; margin:10px auto 0;
            flex-shrink:0;
        }

        /* Sheet Header */
        .sheet-header {
            display:flex; align-items:center; justify-content:space-between;
            padding: 12px 18px 8px;
            flex-shrink:0;
        }
        .sheet-title { font-size:1.05rem; font-weight:800; color:#fff; }
        .sheet-close {
            background:rgba(255,255,255,0.08); border:none; color:#aaa;
            width:28px; height:28px; border-radius:50%;
            font-size:1rem; cursor:pointer; display:flex;
            align-items:center; justify-content:center;
        }
        .sheet-close:active { background:rgba(255,255,255,0.15); }

        /* Kategori Tabs */
        .cat-tabs {
            display:flex; gap:6px; padding:0 18px;
            flex-shrink:0; margin-bottom:10px;
            overflow-x:auto; -webkit-overflow-scrolling:touch;
        }
        .cat-tabs::-webkit-scrollbar { display:none; }

        .cat-tab {
            flex-shrink:0;
            background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1);
            color:#777; padding:7px 14px; border-radius:20px; font-size:0.72rem;
            font-weight:700; cursor:pointer; white-space:nowrap;
            transition:0.2s; display:flex; align-items:center; gap:5px;
        }
        .cat-tab .tab-icon { font-size:0.85rem; }
        .cat-tab.active {
            background:var(--secondary); border-color:var(--secondary); color:white;
        }

        /* Cards Scroll */
        .cards-scroll {
            flex:1; overflow-y:auto; display:flex; flex-direction:column;
            gap:7px; padding:0 18px 24px;
        }
        .cards-scroll::-webkit-scrollbar { width:3px; }
        .cards-scroll::-webkit-scrollbar-thumb { background:rgba(168,85,247,0.4); border-radius:10px; }

        /* CARD */
        .card {
            background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1);
            border-radius:14px; padding:12px 14px; display:flex;
            justify-content:space-between; align-items:center;
            cursor:pointer; transition:0.15s;
        }
        .card:active { transform:scale(0.97); }
        .card.can-buy { border-color:rgba(168,85,247,0.5); background:rgba(168,85,247,0.08); }
        .card.locked { opacity:0.3; cursor:not-allowed; }
        .card.locked:active { transform:none; }
        .card.cant-afford { opacity:0.5; cursor:not-allowed; }
        .card.cant-afford:active { transform:none; }

        .card-left { display:flex; align-items:center; gap:12px; }
        .card-icon { font-size:1.7rem; }
        .card-info { display:flex; flex-direction:column; text-align:left; gap:2px; }
        .card-name { font-size:0.88rem; font-weight:700; color:#fff; letter-spacing:0.2px; }
        .card-earn { font-size:0.72rem; color:#00ff88; font-weight:600; }

        .card-right { display:flex; flex-direction:column; align-items:flex-end; gap:4px; }

        .card-price {
            background:var(--secondary); color:white; border-radius:8px;
            padding:4px 10px; font-weight:700; font-size:0.75rem;
        }
        .card.cant-afford .card-price { background:#444; }
        .card.locked .card-price { background:#333; color:#555; }

        .card-lvl { font-size:0.64rem; color:#666; font-weight:600; }

        /* POPUP */
        .popup-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,0.6);
            display:flex; justify-content:center; align-items:center;
            z-index:999; animation:fadeIn 0.2s;
        }
        .popup-box {
            background:linear-gradient(135deg,#1a1a2e,#2d1b69); border:2px solid var(--secondary);
            border-radius:18px; padding:24px 28px; text-align:center;
            animation:popIn 0.25s cubic-bezier(0.175,0.885,0.32,1.275); max-width:280px; width:90%;
        }
        .popup-box .pop-icon { font-size:2.5rem; margin-bottom:6px; }
        .popup-box h2 { color:var(--primary); font-size:1.4rem; margin-bottom:4px; }
        .popup-box p { color:#aaa; font-size:0.76rem; margin-bottom:14px; }
        .popup-box button {
            background:var(--secondary); border:none; color:white;
            padding:8px 24px; border-radius:9px; font-size:0.82rem; font-weight:bold; cursor:pointer;
        }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        @keyframes popIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
    </style>
</head>
<body>
<div class="game-container">

    <header>
        <h1 id="score">0</h1>
        <p class="sub-label">Coins</p>
        <div class="income-row">üí∞ Saatlik: <span id="hourly-income">0</span> &nbsp;|&nbsp; 3h: <span id="pending-income">0</span></div>

        <div class="mini-bar">
            <div class="bar-label"><span>‚≠ê Level <span id="level-val">1</span></span><span id="xp-text">0 / 100 XP</span></div>
            <div class="bar-track"><div class="bar-fill xp" id="xp-fill"></div></div>
        </div>

        <div class="mini-bar">
            <div class="bar-label"><span>‚ö° Enerji</span><span id="energy-text">1000 / 1000</span></div>
            <div class="bar-track"><div class="bar-fill energy" id="energy-fill"></div></div>
        </div>
    </header>

    <main>
        <div class="combo-container">
            <div id="combo-text">COMBO X1</div>
            <div class="combo-bar"><div id="combo-fill"></div></div>
        </div>
        <div id="coin-container"><div id="main-coin">ü™ô</div></div>
        <div class="collect-row">
            <button class="collect-btn waiting" id="collect-btn">‚è≥ 3:00:00</button>
        </div>
    </main>

    <!-- Ana Ekran: Shop A√ßma Butonu -->
    <div class="bottom-nav">
        <div class="open-shop-btn" id="open-shop-btn">
            <div class="shop-btn-left">
                <span class="shop-btn-icon">üè™</span>
                <div class="shop-btn-text">
                    <span class="shop-btn-title">Kartlar</span>
                    <span class="shop-btn-sub" id="shop-btn-sub">Saatlik: 0 ü™ô</span>
                </div>
            </div>
            <div class="shop-btn-right">
                <span class="shop-btn-badge" id="shop-badge">0</span>
                <span class="shop-btn-arrow">‚Ä∫</span>
            </div>
        </div>
    </div>

    <!-- Bottom Sheet Overlay -->
    <div class="sheet-overlay" id="sheet-overlay"></div>

    <!-- Bottom Sheet: Kart Sayfasƒ± -->
    <div class="sheet" id="sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
            <span class="sheet-title">üè™ Kartlar</span>
            <button class="sheet-close" id="sheet-close">‚úï</button>
        </div>
        <div class="cat-tabs" id="cat-tabs"></div>
        <div class="cards-scroll" id="cards-scroll"></div>
    </div>

</div>

<script>
(function(){

    const CATEGORIES = [
        { id:'profesyoneller', name:'Profesyon', icon:'üëî' },
        { id:'sirketler',      name:'≈ûirketler', icon:'üè¢' },
        { id:'teknoloji',      name:'Teknoloji', icon:'üíª' },
        { id:'yukseltmeler',   name:'Y√ºkseltme', icon:'üí™' }
    ];

    const CARDS = [
        // Profesyoneller
        { id:'freelancer',  cat:'profesyoneller', name:'Freelancer',        icon:'üßë‚Äçüíª', baseCost:100,    baseEarn:50,    unlock:null },
        { id:'danisman',    cat:'profesyoneller', name:'Danƒ±≈üman',          icon:'üìä',  baseCost:500,    baseEarn:200,   unlock:{card:'freelancer', level:3} },
        { id:'muhasebeci',  cat:'profesyoneller', name:'Muhasebeci',        icon:'üßæ',  baseCost:2000,   baseEarn:600,   unlock:{card:'danisman',   level:3} },
        { id:'avukat',      cat:'profesyoneller', name:'Avukat',            icon:'‚öñÔ∏è',  baseCost:8000,   baseEarn:1500,  unlock:{card:'muhasebeci', level:3} },
        { id:'ceo',         cat:'profesyoneller', name:'CEO',               icon:'üé©',  baseCost:35000,  baseEarn:4000,  unlock:{card:'avukat',     level:3} },

        // ≈ûirketler
        { id:'cafe',        cat:'sirketler', name:'Cafe',              icon:'‚òï',  baseCost:200,    baseEarn:80,    unlock:null },
        { id:'restoran',    cat:'sirketler', name:'Restoran',          icon:'üçΩÔ∏è', baseCost:1200,   baseEarn:350,   unlock:{card:'cafe',      level:3} },
        { id:'butik',       cat:'sirketler', name:'Boutique',          icon:'üëó',  baseCost:5000,   baseEarn:900,   unlock:{card:'restoran',  level:3} },
        { id:'otel',        cat:'sirketler', name:'Otel',              icon:'üè®',  baseCost:22000,  baseEarn:2500,  unlock:{card:'butik',     level:3} },
        { id:'alisveris',   cat:'sirketler', name:'Alƒ±≈üveri≈ü Merkezi', icon:'üõí',  baseCost:100000, baseEarn:8000,  unlock:{card:'otel',      level:3} },

        // Teknoloji
        { id:'app',         cat:'teknoloji', name:'App Geli≈ütirme',    icon:'üì±',  baseCost:300,    baseEarn:100,   unlock:null },
        { id:'saas',        cat:'teknoloji', name:'SaaS Platforma',    icon:'‚òÅÔ∏è',  baseCost:1800,   baseEarn:450,   unlock:{card:'app',    level:3} },
        { id:'kripto',      cat:'teknoloji', name:'Kripto Madencilik', icon:'‚õèÔ∏è',  baseCost:7000,   baseEarn:1200,  unlock:{card:'saas',   level:3} },
        { id:'ai',          cat:'teknoloji', name:'AI Startup',        icon:'ü§ñ',  baseCost:30000,  baseEarn:3500,  unlock:{card:'kripto', level:3} },
        { id:'uzay',        cat:'teknoloji', name:'Uzay Teknoloji',    icon:'üöÄ',  baseCost:150000, baseEarn:12000, unlock:{card:'ai',     level:3} },

        // Y√ºkseltmeler
        { id:'clickpower',  cat:'yukseltmeler', name:'Tƒ±klama G√ºc√º', icon:'üí™', baseCost:50, baseEarn:0, unlock:null, isUpgrade:true }
    ];

    const COST_MULT   = 1.15;
    const EARN_MULT   = 1.12;
    const ENERGY_COST = 1;
    const ENERGY_REGEN= 1;
    const COMBO_TIME  = 2;
    const MAX_COMBO   = 10;
    const COLLECT_DUR = 3*3600;

    // STATE
    function defaultState() {
        let cards = {};
        CARDS.forEach(c => { cards[c.id] = {level:0}; });
        return {
            score:0, level:1, xp:0, xpToNextLevel:100,
            clickPower:1, energy:1000, maxEnergy:1000,
            lastUpdate:Date.now(), collectTimer:0, cards:cards
        };
    }

    let gs = defaultState();
    let combo=1, comboTimer=0, lastLoop=Date.now();
    let activeCat = 'profesyoneller';

    // SAVE / LOAD
    const KEY = 'tapGameSave_v5';
    function save() {
        gs.lastUpdate = Date.now();
        let d = JSON.stringify(gs);
        try{localStorage.setItem(KEY,d);}catch(e){}
        try{sessionStorage.setItem(KEY,d);}catch(e){}
    }
    function load() {
        let s=null;
        try{s=localStorage.getItem(KEY);}catch(e){}
        if(!s) try{s=sessionStorage.getItem(KEY);}catch(e){}
        if(s){
            try{
                let ld=JSON.parse(s);
                CARDS.forEach(c=>{ if(!ld.cards[c.id]) ld.cards[c.id]={level:0}; });
                gs=ld;
            }catch(e){}
        }
    }

    // CALC
    function cardCost(c){ return Math.floor(c.baseCost * Math.pow(COST_MULT, gs.cards[c.id].level)); }

    function cardEarn(c){
        let l=gs.cards[c.id].level;
        if(l===0) return 0;
        return Math.floor(c.baseEarn * Math.pow(EARN_MULT, l-1) * l);
    }

    function cardEarnNext(c){
        let l=gs.cards[c.id].level;
        return Math.floor(c.baseEarn * Math.pow(EARN_MULT, l) * (l+1));
    }

    function totalEarn(){
        let t=0;
        CARDS.forEach(c=>{ if(!c.isUpgrade) t+=cardEarn(c); });
        return t;
    }

    function isOpen(c){ return !c.unlock || gs.cards[c.unlock.card].level >= c.unlock.level; }

    function cpCost(){ return Math.floor(50*Math.pow(1.5, gs.clickPower-1)); }

    // OFFLINE
    function offlineCalc(){
        let now=Date.now();
        let diff=Math.floor((now-gs.lastUpdate)/1000);
        if(gs.collectTimer>0 && diff>0) gs.collectTimer=Math.max(0, gs.collectTimer-diff);
        gs.lastUpdate=now;
    }

    // LEVEL UP
    function checkLvl(){
        if(gs.xp >= gs.xpToNextLevel){
            gs.level++;
            gs.xp=0;
            gs.xpToNextLevel=Math.floor(gs.xpToNextLevel*1.6);
            gs.maxEnergy+=50;
            gs.energy=gs.maxEnergy;
            let bonus=gs.level*100;
            gs.score+=bonus;
            popup('üéâ','Level '+gs.level+'!','+'+bonus.toLocaleString()+' coin bonus & enerji doldu!');
        }
    }

    // COLLECT
    function pendingR(){ return Math.floor((totalEarn()/3600)*COLLECT_DUR); }

    function collect(){
        if(gs.collectTimer>0) return;
        let r=pendingR();
        if(r<=0) return;
        gs.score+=r;
        gs.collectTimer=COLLECT_DUR;
        save(); renderUI();
    }

    // BUY
    function buyCard(c){
        if(c.isUpgrade){buyCP();return;}
        if(!isOpen(c)) return;
        let cost=cardCost(c);
        if(gs.score<cost) return;
        gs.score-=cost;
        gs.cards[c.id].level++;
        save(); renderUI();
    }

    function buyCP(){
        let cost=cpCost();
        if(gs.score<cost) return;
        gs.score-=cost;
        gs.clickPower++;
        save(); renderUI();
    }

    // TAP
    let lastTap=0;
    function handleTap(e){
        let now=Date.now();
        if(now-lastTap<300) return;
        lastTap=now;
        e.preventDefault();
        if(gs.energy<ENERGY_COST) return;

        comboTimer=COMBO_TIME;
        if(combo<MAX_COMBO) combo+=0.3;

        let gain=Math.floor(gs.clickPower*combo);
        gs.score+=gain;
        gs.xp+=1;
        gs.energy-=ENERGY_COST;
        checkLvl();

        let cx,cy;
        if(e.touches&&e.touches.length){cx=e.touches[0].clientX;cy=e.touches[0].clientY;}
        else if(e.changedTouches&&e.changedTouches.length){cx=e.changedTouches[0].clientX;cy=e.changedTouches[0].clientY;}
        else{cx=e.clientX;cy=e.clientY;}
        ftxt(cx,cy,'+'+gain);
        renderUI();
    }

    let coinEl=document.getElementById('coin-container');
    coinEl.addEventListener('touchstart',handleTap,{passive:false});
    coinEl.addEventListener('click',handleTap);

    // FLOATING TEXT
    function ftxt(x,y,t){
        let el=document.createElement('div');
        el.className='floating-text';
        el.innerText=t;
        el.style.left=(x-12)+'px';
        el.style.top=(y-35)+'px';
        document.body.appendChild(el);
        setTimeout(()=>el.remove(),800);
    }

    // POPUP
    function popup(icon,title,desc){
        let p=document.createElement('div');
        p.className='popup-overlay';
        p.innerHTML='<div class="popup-box"><div class="pop-icon">'+icon+'</div><h2>'+title+'</h2><p>'+desc+'</p><button onclick="this.closest(\'.popup-overlay\').remove()">Devam ‚Üí</button></div>';
        document.body.appendChild(p);
    }

    // GAME LOOP
    function loop(){
        let now=Date.now();
        let dt=(now-lastLoop)/1000;
        lastLoop=now;

        if(gs.energy<gs.maxEnergy) gs.energy=Math.min(gs.maxEnergy, gs.energy+ENERGY_REGEN*dt);
        if(gs.collectTimer>0){ gs.collectTimer-=dt; if(gs.collectTimer<0) gs.collectTimer=0; }
        if(comboTimer>0){ comboTimer-=dt; if(comboTimer<=0){comboTimer=0;combo=1;} } else combo=1;

        renderUI();
    }

    // FORMAT TIME
    function fmtTime(s){
        s=Math.max(0,Math.ceil(s));
        let h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60;
        return h+':'+String(m).padStart(2,'0')+':'+String(sec).padStart(2,'0');
    }

    // RENDER TABS
    function renderTabs(){
        let el=document.getElementById('cat-tabs');
        el.innerHTML='';
        CATEGORIES.forEach(cat=>{
            let btn=document.createElement('div');
            btn.className='cat-tab'+(activeCat===cat.id?' active':'');
            btn.innerHTML='<span class="tab-icon">'+cat.icon+'</span>'+cat.name;
            btn.onclick=()=>{ activeCat=cat.id; renderTabs(); renderCards(); };
            el.appendChild(btn);
        });
    }

    // RENDER CARDS
    function renderCards(){
        let scroll=document.getElementById('cards-scroll');
        scroll.innerHTML='';

        CARDS.filter(c=>c.cat===activeCat).forEach(card=>{
            let lvl=gs.cards[card.id].level;
            let opened=isOpen(card);
            let cost=cardCost(card);
            let canBuy=opened && gs.score>=cost;
            let el=document.createElement('div');

            // LOCKED
            if(!opened){
                el.className='card locked';
                let req=CARDS.find(c=>c.id===card.unlock.card);
                el.innerHTML=
                    '<div class="card-left">'+
                        '<span class="card-icon">üîí</span>'+
                        '<div class="card-info">'+
                            '<span class="card-name">'+card.name+'</span>'+
                            '<span class="card-earn" style="color:#555">'+req.name+' Lv.'+card.unlock.level+' gerekli</span>'+
                        '</div>'+
                    '</div>'+
                    '<span style="font-size:0.8rem;color:#444">üîê</span>';
                scroll.appendChild(el);
                return;
            }

            // UPGRADE (click power)
            if(card.isUpgrade){
                el.className='card'+(canBuy?' can-buy':' cant-afford');
                el.onclick=()=>buyCP();
                el.innerHTML=
                    '<div class="card-left">'+
                        '<span class="card-icon">'+card.icon+'</span>'+
                        '<div class="card-info">'+
                            '<span class="card-name">'+card.name+'</span>'+
                            '<span class="card-earn">≈ûu an: '+gs.clickPower+'x</span>'+
                        '</div>'+
                    '</div>'+
                    '<div class="card-right">'+
                        '<span class="card-price">'+cost.toLocaleString()+' ü™ô</span>'+
                        '<span class="card-lvl">Lv.'+lvl+'</span>'+
                    '</div>';
                scroll.appendChild(el);
                return;
            }

            // NORMAL CARD
            el.className='card'+(canBuy?' can-buy':' cant-afford');
            el.onclick=()=>buyCard(card);

            let earnStr;
            if(lvl===0) earnStr='+'+cardEarnNext(card).toLocaleString()+'/h';
            else earnStr=cardEarn(card).toLocaleString()+'/h ‚Üí '+cardEarnNext(card).toLocaleString();

            el.innerHTML=
                '<div class="card-left">'+
                    '<span class="card-icon">'+card.icon+'</span>'+
                    '<div class="card-info">'+
                        '<span class="card-name">'+card.name+'</span>'+
                        '<span class="card-earn">'+earnStr+'</span>'+
                    '</div>'+
                '</div>'+
                '<div class="card-right">'+
                    '<span class="card-price">'+cost.toLocaleString()+' ü™ô</span>'+
                    '<span class="card-lvl">Lv.'+lvl+'</span>'+
                '</div>';
            scroll.appendChild(el);
        });
    }

    // RENDER UI
    function renderUI(){
        document.getElementById('score').innerText=Math.floor(gs.score).toLocaleString();

        let eh=totalEarn();
        document.getElementById('hourly-income').innerText=eh.toLocaleString();
        document.getElementById('pending-income').innerText=pendingR().toLocaleString();

        document.getElementById('level-val').innerText=gs.level;
        document.getElementById('xp-text').innerText=Math.floor(gs.xp)+' / '+gs.xpToNextLevel+' XP';
        document.getElementById('xp-fill').style.width=(gs.xp/gs.xpToNextLevel*100)+'%';

        document.getElementById('energy-text').innerText=Math.floor(gs.energy)+' / '+gs.maxEnergy;
        document.getElementById('energy-fill').style.width=(gs.energy/gs.maxEnergy*100)+'%';

        let cp=comboTimer>0?(comboTimer/COMBO_TIME*100):0;
        document.getElementById('combo-fill').style.width=cp+'%';
        document.getElementById('combo-text').style.opacity=comboTimer>0?'1':'0';
        document.getElementById('combo-text').innerText='COMBO X'+Math.floor(combo);

        let cBtn=document.getElementById('collect-btn');
        let pend=pendingR();
        if(gs.collectTimer>0){
            cBtn.className='collect-btn waiting';
            cBtn.innerText='‚è≥ '+fmtTime(gs.collectTimer);
        } else if(pend>0){
            cBtn.className='collect-btn';
            cBtn.innerText='üí∞ '+pend.toLocaleString()+' ü™ô Topla';
        } else {
            cBtn.className='collect-btn waiting';
            cBtn.innerText='‚è≥ Kart al ister misin';
        }

        coinEl.className=gs.energy<ENERGY_COST?'coin-disabled':'';

        // Shop butonu g√ºncelleme
        document.getElementById('shop-btn-sub').innerText = 'Saatlik: ' + eh.toLocaleString() + ' ü™ô';
        let ownedCount = 0;
        CARDS.forEach(c=>{ if(!c.isUpgrade && gs.cards[c.id].level>0) ownedCount++; });
        document.getElementById('shop-badge').innerText = ownedCount;

        // Eƒüer sheet a√ßƒ±ksa kartlarƒ± da yenile
        if(sheetOpen) renderCards();
    }

    // SHEET A√áMA / KAPATMA
    let sheetOpen = false;
    function openSheet(){
        sheetOpen = true;
        document.getElementById('sheet-overlay').classList.add('open');
        document.getElementById('sheet').classList.add('open');
        renderTabs();
        renderCards();
    }
    function closeSheet(){
        sheetOpen = false;
        document.getElementById('sheet-overlay').classList.remove('open');
        document.getElementById('sheet').classList.remove('open');
    }

    document.getElementById('open-shop-btn').addEventListener('click', openSheet);
    document.getElementById('sheet-overlay').addEventListener('click', closeSheet);
    document.getElementById('sheet-close').addEventListener('click', closeSheet);

    // START
    load();
    offlineCalc();
    lastLoop=Date.now();
    renderTabs();
    renderUI();
    setInterval(loop,100);
    setInterval(save,3000);

    document.getElementById('collect-btn').addEventListener('click', collect);

})();
</script>
</body>
</html>
