<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coin Empire - Modern Clicker</title>
    <style>
        :root {
            --primary: #ffd700;
            --secondary: #a855f7;
            --accent: #ec4899;
            --success: #00ff88;
            --warning: #ffaa00;
            --text: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle at center, #1a1a2e 0%, #0a0a0f 100%);
            color: var(--text);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 14px 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }

        /* HEADER */
        header { 
            text-align: center; 
            flex-shrink: 0; 
            padding-top: 10px;
        }

        #score {
            font-size: 2.8rem;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            line-height: 1.1;
        }

        .sub-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 2px; }

        .income-row {
            font-size: 0.75rem;
            color: #ffd700;
            margin-top: 3px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .mini-bar {
            margin-top: 5px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .bar-track { 
            height: 7px; 
            background: rgba(0,0,0,0.3); 
            border-radius: 10px; 
            overflow: hidden; 
            position: relative;
        }
        .bar-fill { 
            height:100%; 
            border-radius:10px; 
            width:0%; 
            transition: width 0.3s ease-out;
            position: absolute;
            top: 0;
            left: 0;
        }
        .bar-fill.xp { background: linear-gradient(90deg, var(--secondary), var(--accent)); }
        .bar-fill.energy { background: linear-gradient(90deg, #00ff88, #00d9ff); }
        .bar-fill.quest { background: linear-gradient(90deg, #ff6b6b, #ffaa00); }

        .bar-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.68rem;
            margin-bottom: 3px;
            font-weight: bold;
        }

        /* DAILY QUEST */
        .quest-container {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 8px 12px;
            margin-top: 8px;
            display: none;
        }

        .quest-container.active { display: block; }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .quest-title {
            font-size: 0.75rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .quest-progress {
            font-size: 0.65rem;
            color: #aaa;
        }

        .quest-reward {
            font-size: 0.65rem;
            color: #ffd700;
            font-weight: bold;
        }

        /* MAIN - D√úZENLENDƒ∞ */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0 10px;
            min-height: 280px;
        }

        .combo-container { 
            width:120px; 
            text-align:center; 
            margin-bottom:8px; 
            height:18px; 
        }

        #combo-text { 
            font-size:0.78rem; 
            font-weight:900; 
            color:var(--accent); 
            opacity:0; 
            transition:opacity 0.2s; 
        }

        .combo-bar { 
            height:3px; 
            background:rgba(0,0,0,0.3); 
            border-radius:10px; 
            overflow:hidden; 
            margin-top:2px; 
        }
        #combo-fill { 
            height:100%; 
            width:0%; 
            background:var(--accent); 
            box-shadow:0 0 6px var(--accent); 
            transition:width 0.1s; 
        }

        #coin-container {
            position:relative;
            cursor:pointer;
            touch-action:manipulation;
            transition: transform 0.1s;
            margin: 10px 0;
        }

        #main-coin {
            font-size: 100px;
            filter: drop-shadow(0 0 18px rgba(255,215,0,0.25));
            animation: float 3s infinite ease-in-out;
            line-height: 1;
            transition: all 0.2s;
        }

        #coin-container:active #main-coin {
            transform: scale(0.8);
            filter: drop-shadow(0 0 25px rgba(255,215,0,0.8));
        }

        .coin-disabled #main-coin {
            filter: grayscale(1) drop-shadow(0 0 8px rgba(100,100,100,0.3));
            animation: shake 0.5s;
        }

        @keyframes float {
            0%,100% { transform:translateY(0) scale(1); }
            50% { transform:translateY(-7px) scale(1.05); }
        }

        @keyframes shake {
            0%,100% { transform:translateX(0); }
            25% { transform:translateX(-5px); }
            75% { transform:translateX(5px); }
        }

        .collect-row { 
            margin-top:10px; 
            display:flex; 
            justify-content:center; 
        }

        .collect-btn {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border:none; 
            color:#1a1a2e; 
            padding:8px 16px;
            border-radius:9px; 
            font-size:0.74rem; 
            font-weight:900;
            cursor:pointer; 
            transition:0.15s;
            box-shadow: 0 4px 10px rgba(255, 170, 0, 0.3);
            min-width: 160px;
        }
        .collect-btn:active { transform:scale(0.93); }
        .collect-btn.waiting { 
            background:rgba(255,255,255,0.07); 
            color:#aaa; 
            cursor:not-allowed; 
            pointer-events:none; 
            box-shadow:none; 
        }

        /* FLOATING */
        .floating-text {
            position:fixed; 
            font-weight:bold; 
            font-size:1.2rem;
            pointer-events:none; 
            animation:floatUp 0.8s forwards; 
            z-index:1000;
            text-shadow:0 0 6px rgba(0,0,0,0.5);
        }
        @keyframes floatUp { 
            from{opacity:1;transform:translateY(0)} 
            to{opacity:0;transform:translateY(-90px)} 
        }

        /* ACHIEVEMENT NOTIFICATION */
        .achievement-notif {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #2d1b69, #1a1a2e);
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .achievement-notif.show {
            transform: translateX(-50%) translateY(0);
        }

        .achievement-icon {
            font-size: 1.8rem;
        }

        .achievement-text {
            display: flex;
            flex-direction: column;
        }

        .achievement-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--primary);
        }

        .achievement-desc {
            font-size: 0.7rem;
            color: #aaa;
        }

        /* BOTTOM NAV BAR */
        .bottom-nav {
            flex-shrink:0;
            margin-top: auto;
            padding: 10px 0;
        }

        .open-shop-btn {
            width:100%;
            background: linear-gradient(135deg, rgba(168,85,247,0.25), rgba(168,85,247,0.1));
            border: 1px solid rgba(168,85,247,0.45);
            border-radius: 14px;
            padding: 13px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: 0.15s;
        }
        .open-shop-btn:active { 
            transform:scale(0.97); 
            background:rgba(168,85,247,0.3); 
        }

        .shop-btn-left { 
            display:flex; 
            align-items:center; 
            gap:12px; 
        }
        .shop-btn-icon { font-size:1.6rem; }
        .shop-btn-text { 
            display:flex; 
            flex-direction:column; 
            text-align:left; 
        }
        .shop-btn-title { 
            font-size:0.88rem; 
            font-weight:800; 
            color:#fff; 
            letter-spacing:0.3px; 
        }
        .shop-btn-sub { 
            font-size:0.68rem; 
            color:#888; 
            margin-top:1px; 
        }

        .shop-btn-right { 
            display:flex; 
            align-items:center; 
            gap:8px; 
        }
        .shop-btn-badge {
            background: var(--secondary);
            color:#fff; 
            font-size:0.62rem; 
            font-weight:800;
            padding:2px 7px; 
            border-radius:20px;
        }
        .shop-btn-arrow { 
            color:rgba(168,85,247,0.7); 
            font-size:1.1rem; 
        }

        /* ===== BOTTOM SHEET (Kart Sayfasƒ±) D√úZENLENDƒ∞ ===== */
        .sheet-overlay {
            position:fixed; 
            inset:0;
            background:rgba(0,0,0,0.55);
            z-index:500;
            opacity:0; 
            pointer-events:none;
            transition: opacity 0.25s;
        }
        .sheet-overlay.open { 
            opacity:1; 
            pointer-events:auto; 
        }

        .sheet {
            position:fixed;
            bottom:0; 
            left:50%; 
            transform:translateX(-50%) translateY(100%);
            width:100%; 
            max-width:450px;
            background: #12121f;
            border-radius: 22px 22px 0 0;
            border-top: 1px solid rgba(255,255,255,0.1);
            height: 75vh; /* Y√úKSELDƒ∞ */
            display:flex; 
            flex-direction:column;
            z-index:501;
            transition: transform 0.3s cubic-bezier(0.32,0.72,0,1);
            overflow:hidden;
        }
        .sheet.open { 
            transform:translateX(-50%) translateY(0); 
        }

        /* Sheet handle */
        .sheet-handle {
            width:40px; 
            height:4px; 
            background:rgba(255,255,255,0.2);
            border-radius:3px; 
            margin:10px auto 0;
            flex-shrink:0;
        }

        /* Sheet Header */
        .sheet-header {
            display:flex; 
            align-items:center; 
            justify-content:space-between;
            padding: 12px 18px 8px;
            flex-shrink:0;
        }
        .sheet-title { 
            font-size:1.05rem; 
            font-weight:800; 
            color:#fff; 
        }
        .sheet-close {
            background:rgba(255,255,255,0.08); 
            border:none; 
            color:#aaa;
            width:28px; 
            height:28px; 
            border-radius:50%;
            font-size:1rem; 
            cursor:pointer; 
            display:flex;
            align-items:center; 
            justify-content:center;
        }
        .sheet-close:active { 
            background:rgba(255,255,255,0.15); 
        }

        /* Kategori Tabs */
        .cat-tabs {
            display:flex; 
            gap:6px; 
            padding:0 18px;
            flex-shrink:0; 
            margin-bottom:10px;
            overflow-x:auto; 
            -webkit-overflow-scrolling:touch;
            padding-bottom: 5px;
        }
        .cat-tabs::-webkit-scrollbar { 
            display:none; 
        }

        .cat-tab {
            flex-shrink:0;
            background:rgba(255,255,255,0.06); 
            border:1px solid rgba(255,255,255,0.1);
            color:#777; 
            padding:7px 14px; 
            border-radius:20px; 
            font-size:0.72rem;
            font-weight:700; 
            cursor:pointer; 
            white-space:nowrap;
            transition:0.2s; 
            display:flex; 
            align-items:center; 
            gap:5px;
        }
        .cat-tab .tab-icon { 
            font-size:0.85rem; 
        }
        .cat-tab.active {
            background:var(--secondary); 
            border-color:var(--secondary); 
            color:white;
        }

        /* Cards Scroll - D√úZENLENDƒ∞ */
        .cards-scroll {
            flex:1; 
            overflow-y:auto; 
            display:flex; 
            flex-direction:column;
            gap:7px; 
            padding:0 18px 80px; /* Alt bo≈üluk arttƒ± */
            min-height: 0;
        }
        .cards-scroll::-webkit-scrollbar { 
            width:3px; 
        }
        .cards-scroll::-webkit-scrollbar-thumb { 
            background:rgba(168,85,247,0.4); 
            border-radius:10px; 
        }

        /* CARD - D√úZENLENDƒ∞ */
        .card {
            background:rgba(255,255,255,0.06); 
            border:1px solid rgba(255,255,255,0.1);
            border-radius:14px; 
            padding:12px 14px; 
            display:flex;
            justify-content:space-between; 
            align-items:center;
            cursor:pointer; 
            transition:0.15s;
            min-height: 70px;
        }
        .card:active { 
            transform:scale(0.97); 
        }
        .card.can-buy { 
            border-color:rgba(168,85,247,0.5); 
            background:rgba(168,85,247,0.08); 
        }
        .card.locked { 
            opacity:0.5; 
            cursor:not-allowed; 
        }
        .card.locked:active { 
            transform:none; 
        }
        .card.cant-afford { 
            opacity:0.7; 
            cursor:not-allowed; 
        }
        .card.cant-afford:active { 
            transform:none; 
        }

        .card-left { 
            display:flex; 
            align-items:center; 
            gap:12px; 
            flex:1;
            min-width: 0;
        }
        .card-icon { 
            font-size:1.7rem; 
            flex-shrink: 0;
        }
        .card-info { 
            display:flex; 
            flex-direction:column; 
            text-align:left; 
            gap:2px; 
            flex:1;
            min-width: 0;
        }
        .card-name { 
            font-size:0.88rem; 
            font-weight:700; 
            color:#fff; 
            letter-spacing:0.2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .card-earn { 
            font-size:0.72rem; 
            color:#00ff88; 
            font-weight:600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-right { 
            display:flex; 
            flex-direction:column; 
            align-items:flex-end; 
            gap:4px; 
            flex-shrink: 0;
        }

        .card-price {
            background:var(--secondary); 
            color:white; 
            border-radius:8px;
            padding:4px 10px; 
            font-weight:700; 
            font-size:0.75rem;
            white-space: nowrap;
        }
        .card.cant-afford .card-price { 
            background:#444; 
        }
        .card.locked .card-price { 
            background:#333; 
            color:#555; 
        }

        .card-lvl { 
            font-size:0.64rem; 
            color:#666; 
            font-weight:600; 
            white-space: nowrap;
        }

        /* ACHIEVEMENTS TAB - D√úZENLENDƒ∞ */
        .achievement-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 10px 12px;
            margin-bottom: 8px;
        }

        .achievement-card.completed {
            background: rgba(0, 255, 136, 0.05);
            border-color: rgba(0, 255, 136, 0.3);
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .achievement-icon-small {
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .achievement-desc-small {
            font-size: 0.65rem;
            color: #aaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .achievement-progress {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 6px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #ffaa00);
            width: 0%;
            transition: width 0.5s;
        }

        /* POPUP */
        .popup-overlay {
            position:fixed; 
            inset:0; 
            background:rgba(0,0,0,0.6);
            display:flex; 
            justify-content:center; 
            align-items:center;
            z-index:999; 
            animation:fadeIn 0.2s;
        }
        .popup-box {
            background:linear-gradient(135deg,#1a1a2e,#2d1b69); 
            border:2px solid var(--secondary);
            border-radius:18px; 
            padding:24px 28px; 
            text-align:center;
            animation:popIn 0.25s cubic-bezier(0.175,0.885,0.32,1.275); 
            max-width:280px; 
            width:90%;
        }
        .popup-box .pop-icon { 
            font-size:2.5rem; 
            margin-bottom:6px; 
        }
        .popup-box h2 { 
            color:var(--primary); 
            font-size:1.4rem; 
            margin-bottom:4px; 
        }
        .popup-box p { 
            color:#aaa; 
            font-size:0.76rem; 
            margin-bottom:14px; 
        }
        .popup-box button {
            background:var(--secondary); 
            border:none; 
            color:white;
            padding:8px 24px; 
            border-radius:9px; 
            font-size:0.82rem; 
            font-weight:bold; 
            cursor:pointer;
        }
        @keyframes fadeIn { 
            from{opacity:0} to{opacity:1} 
        }
        @keyframes popIn { 
            from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} 
        }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 480px) {
            .game-container { 
                padding: 12px 14px; 
            }
            #main-coin { 
                font-size: 85px; 
            }
            #score { 
                font-size: 2.4rem; 
            }
            .collect-btn { 
                padding: 8px 16px; 
                font-size: 0.8rem; 
            }
            .card { 
                padding: 14px 12px; 
            }
            .card-name { 
                font-size: 0.85rem; 
            }
            .sheet {
                height: 80vh;
            }
        }

        /* ENERGY WARNING */
        .energy-warning {
            color: #ff5555 !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
<div class="game-container">

    <!-- Achievement Notification -->
    <div class="achievement-notif" id="achievement-notif">
        <div class="achievement-icon" id="achievement-notif-icon">üèÜ</div>
        <div class="achievement-text">
            <div class="achievement-title" id="achievement-notif-title">Ba≈üarƒ±m A√ßƒ±ldƒ±!</div>
            <div class="achievement-desc" id="achievement-notif-desc">ƒ∞lk 1000 coin kazandƒ±n</div>
        </div>
    </div>

    <header>
        <h1 id="score">200</h1>
        <p class="sub-label">Coins</p>
        <div class="income-row">üí∞ Saatlik: <span id="hourly-income">0</span> &nbsp;|&nbsp; 3h: <span id="pending-income">0</span></div>

        <div class="mini-bar">
            <div class="bar-label"><span>‚≠ê Level <span id="level-val">1</span></span><span id="xp-text">0 / 100 XP</span></div>
            <div class="bar-track"><div class="bar-fill xp" id="xp-fill"></div></div>
        </div>

        <div class="mini-bar">
            <div class="bar-label"><span>‚ö° Enerji</span><span id="energy-text">1200 / 1200</span></div>
            <div class="bar-track"><div class="bar-fill energy" id="energy-fill"></div></div>
        </div>

        <!-- Daily Quest -->
        <div class="quest-container" id="quest-container">
            <div class="quest-header">
                <span class="quest-title">üéØ G√ºnl√ºk G√∂rev</span>
                <span class="quest-progress" id="quest-progress">0/50</span>
            </div>
            <div class="bar-track">
                <div class="bar-fill quest" id="quest-fill"></div>
            </div>
            <div class="quest-reward" id="quest-reward">√ñd√ºl: 500 ü™ô</div>
        </div>
    </header>

    <main>
        <div class="combo-container">
            <div id="combo-text">COMBO X1</div>
            <div class="combo-bar"><div id="combo-fill"></div></div>
        </div>
        <div id="coin-container"><div id="main-coin">ü™ô</div></div>
        <div class="collect-row">
            <button class="collect-btn waiting" id="collect-btn">‚è≥ 0:30:00</button>
        </div>
    </main>

    <!-- Ana Ekran: Shop A√ßma Butonu -->
    <div class="bottom-nav">
        <div class="open-shop-btn" id="open-shop-btn">
            <div class="shop-btn-left">
                <span class="shop-btn-icon">üè™</span>
                <div class="shop-btn-text">
                    <span class="shop-btn-title">Kartlar & Ba≈üarƒ±mlar</span>
                    <span class="shop-btn-sub" id="shop-btn-sub">Saatlik: 0 ü™ô</span>
                </div>
            </div>
            <div class="shop-btn-right">
                <span class="shop-btn-badge" id="shop-badge">0</span>
                <span class="shop-btn-arrow">‚Ä∫</span>
            </div>
        </div>
    </div>

    <!-- Bottom Sheet Overlay -->
    <div class="sheet-overlay" id="sheet-overlay"></div>

    <!-- Bottom Sheet: Kart Sayfasƒ± - YUKARI ALINDI -->
    <div class="sheet" id="sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
            <span class="sheet-title">üè™ Kartlar & Ba≈üarƒ±mlar</span>
            <button class="sheet-close" id="sheet-close">‚úï</button>
        </div>
        <div class="cat-tabs" id="cat-tabs"></div>
        <div class="cards-scroll" id="cards-scroll"></div>
    </div>

</div>

<script>
(function(){

    // ==================== KONFƒ∞G√úRASYON ====================
    const CATEGORIES = [
        { id:'profesyoneller', name:'Profesyon', icon:'üëî' },
        { id:'sirketler',      name:'≈ûirketler', icon:'üè¢' },
        { id:'teknoloji',      name:'Teknoloji', icon:'üíª' },
        { id:'yukseltmeler',   name:'Y√ºkseltme', icon:'üí™' },
        { id:'basari',         name:'Ba≈üarƒ±mlar', icon:'üèÜ' }
    ];

    const CARDS = [
        // Profesyoneller
        { id:'freelancer',  cat:'profesyoneller', name:'Freelancer',        icon:'üßë‚Äçüíª', baseCost:30,    baseEarn:15,    unlock:null },
        { id:'danisman',    cat:'profesyoneller', name:'Danƒ±≈üman',          icon:'üìä',  baseCost:150,   baseEarn:50,   unlock:{card:'freelancer', level:2} },
        { id:'muhasebeci',  cat:'profesyoneller', name:'Muhasebeci',        icon:'üßæ',  baseCost:500,   baseEarn:150,   unlock:{card:'danisman',   level:2} },
        { id:'avukat',      cat:'profesyoneller', name:'Avukat',            icon:'‚öñÔ∏è',  baseCost:2000,   baseEarn:500,  unlock:{card:'muhasebeci', level:2} },
        { id:'ceo',         cat:'profesyoneller', name:'CEO',               icon:'üé©',  baseCost:8000,  baseEarn:1500,  unlock:{card:'avukat',     level:2} },

        // ≈ûirketler
        { id:'cafe',        cat:'sirketler', name:'Cafe',              icon:'‚òï',  baseCost:60,    baseEarn:25,    unlock:null },
        { id:'restoran',    cat:'sirketler', name:'Restoran',          icon:'üçΩÔ∏è', baseCost:300,   baseEarn:100,   unlock:{card:'cafe',      level:2} },
        { id:'butik',       cat:'sirketler', name:'Boutique',          icon:'üëó',  baseCost:1200,   baseEarn:300,   unlock:{card:'restoran',  level:2} },
        { id:'otel',        cat:'sirketler', name:'Otel',              icon:'üè®',  baseCost:5000,  baseEarn:800,  unlock:{card:'butik',     level:2} },
        { id:'alisveris',   cat:'sirketler', name:'Alƒ±≈üveri≈ü Merkezi', icon:'üõí',  baseCost:20000, baseEarn:3000,  unlock:{card:'otel',      level:2} },

        // Teknoloji
        { id:'app',         cat:'teknoloji', name:'App Geli≈ütirme',    icon:'üì±',  baseCost:40,    baseEarn:20,   unlock:null },
        { id:'saas',        cat:'teknoloji', name:'SaaS Platforma',    icon:'‚òÅÔ∏è',  baseCost:200,   baseEarn:80,   unlock:{card:'app',    level:2} },
        { id:'kripto',      cat:'teknoloji', name:'Kripto Madencilik', icon:'‚õèÔ∏è',  baseCost:800,   baseEarn:200,  unlock:{card:'saas',   level:2} },
        { id:'ai',          cat:'teknoloji', name:'AI Startup',        icon:'ü§ñ',  baseCost:3000,  baseEarn:800,  unlock:{card:'kripto', level:2} },
        { id:'uzay',        cat:'teknoloji', name:'Uzay Teknoloji',    icon:'üöÄ',  baseCost:12000, baseEarn:3000, unlock:{card:'ai',     level:2} },

        // Y√ºkseltmeler - D√úZENLENDƒ∞
        { id:'clickpower',  cat:'yukseltmeler', name:'Tƒ±klama G√ºc√º', icon:'üí™', baseCost:25, baseEarn:0, unlock:null, isUpgrade:true }
    ];

    const ACHIEVEMENTS = [
        { id:'first_1000',      name:'ƒ∞lk Binlik',      icon:'üí∞', desc:'1000 coin kazan', condition: () => gs.score >= 1000, reward: 500, claimed: false },
        { id:'tap_100',         name:'Tƒ±klama Ustasƒ±',  icon:'üëÜ', desc:'100 kez tƒ±kla', condition: () => gs.totalTaps >= 100, reward: 300, claimed: false },
        { id:'first_card',      name:'ƒ∞lk Kart',        icon:'üÉè', desc:'ƒ∞lk kartƒ± satƒ±n al', condition: () => countOwnedCards() >= 1, reward: 200, claimed: false },
        { id:'level_5',         name:'Hƒ±zlƒ± Y√ºkseli≈ü',  icon:'üöÄ', desc:'Seviye 5\'e ula≈ü', condition: () => gs.level >= 5, reward: 1000, claimed: false },
        { id:'combo_master',    name:'Combo Ustasƒ±',    icon:'‚ö°', desc:'10x combo yap', condition: () => gs.maxCombo >= 10, reward: 800, claimed: false }
    ];

    const DAILY_QUESTS = [
        { id:'daily_tap_50',    goal: 50,   current: 0, reward: 500,  title: '50 Tƒ±klama', type: 'tap' },
        { id:'daily_buy_3',     goal: 3,    current: 0, reward: 1000, title: '3 Kart Satƒ±n Al', type: 'buy' },
        { id:'daily_combo_5',   goal: 5,    current: 0, reward: 800,  title: '5x Combo Yap', type: 'combo' }
    ];

    const COST_MULT   = 1.12;
    const EARN_MULT   = 1.15;
    const ENERGY_COST = 0.8;
    const ENERGY_REGEN= 1.2;
    const COMBO_TIME  = 2.5;
    const MAX_COMBO   = 15;
    const COLLECT_DUR = 1800;

    // ==================== STATE ====================
    function defaultState() {
        let cards = {};
        CARDS.forEach(c => { cards[c.id] = {level:0}; });
        
        return {
            score: 200,
            level: 1, 
            xp: 0, 
            xpToNextLevel: 100,
            clickPower: 2,
            energy: 1200,
            maxEnergy: 1200,
            lastUpdate: Date.now(), 
            collectTimer: 0, 
            cards: cards,
            totalTaps: 0,
            maxCombo: 1,
            dailyQuests: JSON.parse(JSON.stringify(DAILY_QUESTS)),
            achievements: JSON.parse(JSON.stringify(ACHIEVEMENTS)),
            currentDailyQuest: 0,
            questActive: false,
            lastQuestReset: Date.now()
        };
    }

    let gs = defaultState();
    let combo = 1, comboTimer = 0, lastLoop = Date.now();
    let activeCat = 'profesyoneller';
    let activeQuest = DAILY_QUESTS[0];

    // ==================== SAVE / LOAD ====================
    const KEY = 'tapGameSave_v8';
    
    function save() {
        gs.lastUpdate = Date.now();
        let saveData = {
            version: '1.2',
            timestamp: Date.now(),
            data: gs
        };
        try {
            localStorage.setItem(KEY, JSON.stringify(saveData));
        } catch(e) {
            console.log('Kayƒ±t ba≈üarƒ±sƒ±z');
        }
    }
    
    function load() {
        let saved = null;
        try {
            saved = localStorage.getItem(KEY);
        } catch(e) {}
        
        if(saved) {
            try {
                let parsed = JSON.parse(saved);
                if(parsed.version === '1.2' || parsed.version === '1.1') {
                    // Eski kartlarƒ± kontrol et
                    CARDS.forEach(c => { 
                        if(!parsed.data.cards[c.id]) parsed.data.cards[c.id] = {level:0}; 
                    });
                    gs = parsed.data;
                    
                    // Eski save'ler i√ßin yeni alanlarƒ± ekle
                    if(!gs.totalTaps) gs.totalTaps = 0;
                    if(!gs.maxCombo) gs.maxCombo = 1;
                    
                    checkDailyReset();
                }
            } catch(e) {
                console.log('Y√ºkleme hatasƒ±, yeni oyun ba≈ülatƒ±lƒ±yor');
                gs = defaultState();
            }
        }
    }

    // ==================== G√úNL√úK G√ñREV Sƒ∞STEMƒ∞ ====================
    function checkDailyReset() {
        const now = Date.now();
        const lastReset = gs.lastQuestReset || now;
        const oneDay = 24 * 60 * 60 * 1000;
        
        if(now - lastReset >= oneDay) {
            gs.dailyQuests = JSON.parse(JSON.stringify(DAILY_QUESTS));
            gs.currentDailyQuest = 0;
            gs.questActive = false;
            gs.lastQuestReset = now;
        }
        
        // Aktif g√∂revi belirle
        if(!gs.questActive && gs.dailyQuests.length > 0) {
            gs.questActive = true;
            activeQuest = gs.dailyQuests[gs.currentDailyQuest];
        }
    }

    function updateQuestProgress(type, amount = 1) {
        if(!gs.questActive || !activeQuest) return;
        
        if(activeQuest.type === type) {
            activeQuest.current = Math.min(activeQuest.goal, activeQuest.current + amount);
            if(activeQuest.current >= activeQuest.goal) {
                completeQuest();
            }
            save();
        }
    }

    function completeQuest() {
        if(!gs.questActive || !activeQuest) return;
        
        gs.score += activeQuest.reward;
        showAchievementNotification('üéØ', 'G√∂rev Tamamlandƒ±!', '+' + activeQuest.reward + ' coin kazandƒ±n!');
        
        gs.currentDailyQuest++;
        if(gs.currentDailyQuest < gs.dailyQuests.length) {
            activeQuest = gs.dailyQuests[gs.currentDailyQuest];
        } else {
            gs.questActive = false;
        }
        
        save();
    }

    // ==================== BA≈ûARIM Sƒ∞STEMƒ∞ ====================
    function checkAchievements() {
        gs.achievements.forEach(ach => {
            if(!ach.claimed && ach.condition()) {
                ach.claimed = true;
                gs.score += ach.reward;
                showAchievementNotification(ach.icon, ach.name + ' A√ßƒ±ldƒ±!', ach.desc + ' - +' + ach.reward + ' coin!');
                save();
                return true;
            }
        });
        return false;
    }

    function showAchievementNotification(icon, title, desc) {
        const notif = document.getElementById('achievement-notif');
        const notifIcon = document.getElementById('achievement-notif-icon');
        const notifTitle = document.getElementById('achievement-notif-title');
        const notifDesc = document.getElementById('achievement-notif-desc');
        
        notifIcon.textContent = icon;
        notifTitle.textContent = title;
        notifDesc.textContent = desc;
        
        notif.classList.add('show');
        
        setTimeout(() => {
            notif.classList.remove('show');
        }, 3000);
    }

    // ==================== HESAPLAMA FONKSƒ∞YONLARI ====================
    function cardCost(c){ 
        return Math.floor(c.baseCost * Math.pow(COST_MULT, gs.cards[c.id].level)); 
    }

    function cardEarn(c){
        let l = gs.cards[c.id].level;
        if(l === 0) return 0;
        return Math.floor(c.baseEarn * Math.pow(EARN_MULT, l-1) * l);
    }

    function cardEarnNext(c){
        let l = gs.cards[c.id].level;
        return Math.floor(c.baseEarn * Math.pow(EARN_MULT, l) * (l+1));
    }

    function totalEarn(){
        let t = 0;
        CARDS.forEach(c => { 
            if(!c.isUpgrade) t += cardEarn(c); 
        });
        return t;
    }

    function isOpen(c){ 
        return !c.unlock || gs.cards[c.unlock.card].level >= c.unlock.level; 
    }

    function cpCost(){ 
        return Math.floor(25 * Math.pow(1.4, gs.clickPower-2)); 
    }

    function countOwnedCards(){
        let count = 0;
        CARDS.forEach(c => { 
            if(!c.isUpgrade && gs.cards[c.id].level > 0) count++; 
        });
        return count;
    }

    // ==================== OFFLINE HESAPLAMA ====================
    function offlineCalc(){
        let now = Date.now();
        let diff = Math.floor((now - gs.lastUpdate) / 1000);
        
        if(gs.collectTimer > 0 && diff > 0) {
            gs.collectTimer = Math.max(0, gs.collectTimer - diff);
        }
        
        // Pasif gelir ekle
        if(diff > 0 && totalEarn() > 0) {
            let offlineEarn = Math.floor((totalEarn() / 3600) * Math.min(diff, 3600 * 24));
            if(offlineEarn > 0) {
                gs.score += offlineEarn;
            }
        }
        
        gs.lastUpdate = now;
    }

    // ==================== LEVEL UP ====================
    function checkLvl(){
        if(gs.xp >= gs.xpToNextLevel){
            gs.level++;
            gs.xp = 0;
            gs.xpToNextLevel = Math.floor(gs.xpToNextLevel * 1.5);
            gs.maxEnergy += 100;
            gs.energy = gs.maxEnergy;
            let bonus = gs.level * 200;
            gs.score += bonus;
            
            popup('üéâ', 'Level ' + gs.level + '!', '+' + bonus.toLocaleString() + ' coin bonus & enerji doldu!');
            checkAchievements();
            save();
        }
    }

    // ==================== COLLECT ====================
    function pendingR(){ 
        return Math.floor((totalEarn() / 3600) * COLLECT_DUR); 
    }

    function collect(){
        if(gs.collectTimer > 0) return;
        let r = pendingR();
        if(r <= 0) return;
        
        gs.score += r;
        gs.collectTimer = COLLECT_DUR;
        
        updateQuestProgress('tap', 1);
        
        save(); 
        renderUI();
    }

    // ==================== SATIN ALMA ====================
    function buyCard(card){
        if(card.isUpgrade){ 
            buyCP(); 
            return; 
        }
        
        if(!isOpen(card)) {
            console.log('Kart kilitli:', card.name);
            return;
        }
        
        let cost = cardCost(card);
        if(gs.score < cost) {
            console.log('Yetersiz bakiye:', gs.score, 'gereken:', cost);
            return;
        }
        
        gs.score -= cost;
        gs.cards[card.id].level++;
        
        updateQuestProgress('buy', 1);
        
        // G√∂rsel feedback - D√úZELTƒ∞LDƒ∞
        const cardElement = event ? event.currentTarget : null;
        if(cardElement) {
            cardElement.style.transform = 'scale(0.95)';
            cardElement.style.boxShadow = '0 0 20px rgba(168, 85, 247, 0.5)';
            setTimeout(() => {
                cardElement.style.transform = '';
                cardElement.style.boxShadow = '';
            }, 200);
            
            const rect = cardElement.getBoundingClientRect();
            ftxt(rect.left + 50, rect.top + 20, '‚úÖ Satƒ±n Alƒ±ndƒ±!', '#00ff88');
        }
        
        save(); 
        renderUI();
        checkAchievements();
    }

    function buyCP(){
        let cost = cpCost();
        if(gs.score < cost) return;
        
        gs.score -= cost;
        gs.clickPower++;
        
        // G√∂rsel feedback
        const upgradeElement = document.querySelector('.card[data-card="clickpower"]');
        if(upgradeElement) {
            upgradeElement.style.transform = 'scale(0.95)';
            upgradeElement.style.boxShadow = '0 0 20px gold';
            setTimeout(() => {
                upgradeElement.style.transform = '';
                upgradeElement.style.boxShadow = '';
            }, 200);
            
            const rect = upgradeElement.getBoundingClientRect();
            ftxt(rect.left + 50, rect.top + 20, 'üí™ G√º√ß Arttƒ±!', '#ffaa00');
        }
        
        save(); 
        renderUI();
    }

    // ==================== TIKLAMA - D√úZELTƒ∞LDƒ∞ ====================
    let lastTapTime = 0;
    function handleTap(e){
        let now = Date.now();
        
        // √áift tƒ±klama korumasƒ±
        if(now - lastTapTime < 50) return;
        lastTapTime = now;
        
        // Touch event kontrol√º
        if(e.preventDefault) e.preventDefault();
        
        // Enerji kontrol√º
        if(gs.energy < ENERGY_COST) {
            const coin = document.getElementById('main-coin');
            coin.style.animation = 'shake 0.5s';
            const rect = coin.getBoundingClientRect();
            ftxt(rect.left + 50, rect.top + 50, '‚ö° Enerji Yok!', '#ff5555');
            setTimeout(() => {
                coin.style.animation = '';
            }, 500);
            return;
        }
        
        // Combo sistemi - D√úZELTƒ∞LDƒ∞
        if(now - lastTapTime < 1000 && comboTimer > 0) {
            combo = Math.min(MAX_COMBO, combo + 0.4);
        } else {
            combo = Math.max(1, combo - 0.1);
        }
        comboTimer = COMBO_TIME;
        
        if(Math.floor(combo) > gs.maxCombo) {
            gs.maxCombo = Math.floor(combo);
        }
        
        // Kazan√ß hesapla - D√úZELTƒ∞LDƒ∞
        let gain = Math.floor(gs.clickPower * combo);
        gs.score += gain;
        gs.xp += 1;
        gs.energy -= ENERGY_COST;
        gs.totalTaps++;
        
        // Combo efektleri
        if(combo > 3) {
            const coin = document.getElementById('main-coin');
            const hue = 120 + (combo * 10);
            coin.style.filter = `drop-shadow(0 0 25px hsl(${hue}, 100%, 50%))`;
        }
        
        updateQuestProgress('tap', 1);
        
        checkLvl();
        checkAchievements();
        
        // Pozisyon hesapla - D√úZELTƒ∞LDƒ∞
        let cx, cy;
        if(e.touches && e.touches.length > 0){
            cx = e.touches[0].clientX;
            cy = e.touches[0].clientY;
        } else if(e.changedTouches && e.changedTouches.length > 0){
            cx = e.changedTouches[0].clientX;
            cy = e.changedTouches[0].clientY;
        } else {
            cx = e.clientX || window.innerWidth/2;
            cy = e.clientY || window.innerHeight/2;
        }
        
        // Floating text
        let color = combo > 3 ? '#ffaa00' : '#ffd700';
        let text = '+' + gain;
        if(combo > 5) text += ' COMBO x' + Math.floor(combo);
        
        ftxt(cx, cy, text, color);
        
        renderUI();
    }

    // ==================== FLOATING TEXT ====================
    function ftxt(x, y, t, color = '#ffd700'){
        let el = document.createElement('div');
        el.className = 'floating-text';
        el.innerText = t;
        el.style.left = (x - 12) + 'px';
        el.style.top = (y - 35) + 'px';
        el.style.color = color;
        el.style.textShadow = `0 0 6px ${color}80`;
        document.body.appendChild(el);
        setTimeout(() => {
            if(el.parentNode) el.parentNode.removeChild(el);
        }, 800);
    }

    // ==================== POPUP ====================
    function popup(icon, title, desc){
        let p = document.createElement('div');
        p.className = 'popup-overlay';
        p.innerHTML = '<div class="popup-box"><div class="pop-icon">' + icon + '</div><h2>' + title + '</h2><p>' + desc + '</p><button onclick="this.closest(\'.popup-overlay\').remove()">Devam ‚Üí</button></div>';
        document.body.appendChild(p);
    }

    // ==================== GAME LOOP ====================
    function gameLoop(){
        let now = Date.now();
        let dt = (now - lastLoop) / 1000;
        lastLoop = now;
        
        // Enerji yenileme
        if(gs.energy < gs.maxEnergy) {
            gs.energy = Math.min(gs.maxEnergy, gs.energy + ENERGY_REGEN * dt);
        }
        
        // Collect timer
        if(gs.collectTimer > 0){ 
            gs.collectTimer -= dt; 
            if(gs.collectTimer < 0) gs.collectTimer = 0; 
        }
        
        // Combo timer
        if(comboTimer > 0){ 
            comboTimer -= dt; 
            if(comboTimer <= 0){ 
                comboTimer = 0; 
                combo = 1; 
                
                const coin = document.getElementById('main-coin');
                coin.style.filter = 'drop-shadow(0 0 18px rgba(255,215,0,0.25))';
            }
        }
        
        renderUI();
    }

    // ==================== ZAMAN FORMATI ====================
    function fmtTime(s){
        s = Math.max(0, Math.ceil(s));
        let h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60;
        if(h > 0) {
            return h + ':' + String(m).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
        } else {
            return m + ':' + String(sec).padStart(2, '0');
        }
    }

    // ==================== TAB'LER ====================
    function renderTabs(){
        let el = document.getElementById('cat-tabs');
        if(!el) return;
        
        el.innerHTML = '';
        
        CATEGORIES.forEach(cat => {
            let btn = document.createElement('div');
            btn.className = 'cat-tab' + (activeCat === cat.id ? ' active' : '');
            btn.innerHTML = '<span class="tab-icon">' + cat.icon + '</span>' + cat.name;
            btn.onclick = () => { 
                activeCat = cat.id; 
                renderTabs(); 
                renderContent(); 
            };
            el.appendChild(btn);
        });
    }

    // ==================== ƒ∞√áERƒ∞K RENDER ====================
    function renderContent(){
        if(activeCat === 'basari') {
            renderAchievements();
        } else {
            renderCards();
        }
    }

    // ==================== KARTLAR ====================
    function renderCards(){
        let scroll = document.getElementById('cards-scroll');
        if(!scroll) return;
        
        scroll.innerHTML = '';
        
        let categoryCards = CARDS.filter(c => c.cat === activeCat);
        if(categoryCards.length === 0) return;
        
        categoryCards.forEach(card => {
            let lvl = gs.cards[card.id].level;
            let opened = isOpen(card);
            let cost = cardCost(card);
            let canBuy = opened && gs.score >= cost;
            let el = document.createElement('div');
            el.setAttribute('data-card', card.id);
            el.setAttribute('data-card-id', card.id);
            
            // KILITLI KART
            if(!opened){
                el.className = 'card locked';
                let req = CARDS.find(c => c.id === card.unlock.card);
                if(req) {
                    el.innerHTML = 
                        '<div class="card-left">' +
                            '<span class="card-icon">üîí</span>' +
                            '<div class="card-info">' +
                                '<span class="card-name">' + card.name + '</span>' +
                                '<span class="card-earn" style="color:#aaa">' + req.name + ' Lv.' + card.unlock.level + ' gerekli</span>' +
                            '</div>' +
                        '</div>' +
                        '<span style="font-size:0.8rem;color:#666">üîê</span>';
                }
                scroll.appendChild(el);
                return;
            }
            
            // Y√úKSELTME KARTI - D√úZENLENDƒ∞
            if(card.isUpgrade){
                el.className = 'card' + (canBuy ? ' can-buy' : ' cant-afford');
                el.onclick = (e) => { 
                    buyCP();
                    if(e) e.stopPropagation();
                };
                el.innerHTML = 
                    '<div class="card-left">' +
                        '<span class="card-icon">' + card.icon + '</span>' +
                        '<div class="card-info">' +
                            '<span class="card-name">' + card.name + '</span>' +
                            '<span class="card-earn">≈ûu an: ' + gs.clickPower + 'x tƒ±klama</span>' +
                        '</div>' +
                    '</div>' +
                    '<div class="card-right">' +
                        '<span class="card-price">' + cost.toLocaleString() + ' ü™ô</span>' +
                        '<span class="card-lvl">Seviye: ' + (gs.clickPower-1) + '</span>' +
                    '</div>';
                scroll.appendChild(el);
                return;
            }
            
            // NORMAL KART - D√úZENLENDƒ∞
            el.className = 'card' + (canBuy ? ' can-buy' : ' cant-afford');
            el.onclick = (e) => { 
                buyCard(card); 
                if(e) e.stopPropagation();
            };
            
            let earnStr;
            let currentEarn = cardEarn(card);
            let nextEarn = cardEarnNext(card);
            
            if(lvl === 0) {
                earnStr = 'Kazan√ß: +' + nextEarn.toLocaleString() + '/h';
            } else {
                earnStr = currentEarn.toLocaleString() + '/h ‚Üí ' + nextEarn.toLocaleString() + '/h';
            }
            
            el.innerHTML = 
                '<div class="card-left">' +
                    '<span class="card-icon">' + card.icon + '</span>' +
                    '<div class="card-info">' +
                        '<span class="card-name">' + card.name + '</span>' +
                        '<span class="card-earn">' + earnStr + '</span>' +
                    '</div>' +
                '</div>' +
                '<div class="card-right">' +
                    '<span class="card-price">' + cost.toLocaleString() + ' ü™ô</span>' +
                    '<span class="card-lvl">Lv.' + lvl + '</span>' +
                '</div>';
            scroll.appendChild(el);
        });
    }

    // ==================== BA≈ûARIMLAR - D√úZENLENDƒ∞ ====================
    function renderAchievements(){
        let scroll = document.getElementById('cards-scroll');
        if(!scroll) return;
        
        scroll.innerHTML = '';
        
        gs.achievements.forEach(ach => {
            let el = document.createElement('div');
            el.className = 'achievement-card' + (ach.claimed ? ' completed' : '');
            
            let progress = 0;
            let progressText = '';
            
            if(ach.id === 'first_1000') {
                progress = Math.min(100, (gs.score / 1000) * 100);
                progressText = gs.score + '/1000 coin';
            } else if(ach.id === 'tap_100') {
                progress = Math.min(100, (gs.totalTaps / 100) * 100);
                progressText = gs.totalTaps + '/100 tƒ±klama';
            } else if(ach.id === 'first_card') {
                progress = countOwnedCards() >= 1 ? 100 : 0;
                progressText = countOwnedCards() + '/1 kart';
            } else if(ach.id === 'level_5') {
                progress = Math.min(100, (gs.level / 5) * 100);
                progressText = 'Level ' + gs.level + '/5';
            } else if(ach.id === 'combo_master') {
                progress = Math.min(100, (gs.maxCombo / 10) * 100);
                progressText = 'Maks Combo ' + gs.maxCombo + '/10';
            }
            
            el.innerHTML = 
                '<div class="achievement-header">' +
                    '<span class="achievement-icon-small">' + ach.icon + '</span>' +
                    '<div style="flex:1; min-width:0;">' +
                        '<div class="achievement-name">' + ach.name + (ach.claimed ? ' ‚úÖ' : '') + '</div>' +
                        '<div class="achievement-desc-small">' + ach.desc + '</div>' +
                    '</div>' +
                '</div>' +
                '<div style="font-size:0.7rem; color:#aaa; margin:4px 0;">' + progressText + '</div>' +
                '<div class="achievement-progress">' +
                    '<div class="achievement-progress-fill" style="width:' + progress + '%"></div>' +
                '</div>' +
                '<div style="font-size:0.65rem; color:#ffd700; margin-top:4px; font-weight:bold;">' +
                    '√ñd√ºl: ' + ach.reward + ' ü™ô' +
                '</div>';
            
            scroll.appendChild(el);
        });
    }

    // ==================== UI RENDER - D√úZELTƒ∞LDƒ∞ ====================
    function renderUI(){
        // Skor
        const scoreEl = document.getElementById('score');
        if(scoreEl) scoreEl.textContent = Math.floor(gs.score).toLocaleString();
        
        // Gelirler - D√úZELTƒ∞LDƒ∞
        let totalHourlyEarn = totalEarn();
        const hourlyIncomeEl = document.getElementById('hourly-income');
        const pendingIncomeEl = document.getElementById('pending-income');
        const shopBtnSubEl = document.getElementById('shop-btn-sub');
        
        if(hourlyIncomeEl) hourlyIncomeEl.textContent = totalHourlyEarn.toLocaleString();
        if(pendingIncomeEl) pendingIncomeEl.textContent = pendingR().toLocaleString();
        if(shopBtnSubEl) shopBtnSubEl.textContent = 'Saatlik: ' + totalHourlyEarn.toLocaleString() + ' ü™ô';
        
        // Level ve XP
        const levelValEl = document.getElementById('level-val');
        const xpTextEl = document.getElementById('xp-text');
        const xpFillEl = document.getElementById('xp-fill');
        
        if(levelValEl) levelValEl.textContent = gs.level;
        if(xpTextEl) xpTextEl.textContent = Math.floor(gs.xp) + ' / ' + gs.xpToNextLevel + ' XP';
        if(xpFillEl) xpFillEl.style.width = (gs.xp / gs.xpToNextLevel * 100) + '%';
        
        // Enerji - D√úZELTƒ∞LDƒ∞
        const energyTextEl = document.getElementById('energy-text');
        const energyFillEl = document.getElementById('energy-fill');
        const coinContainer = document.getElementById('coin-container');
        
        if(energyTextEl) {
            energyTextEl.textContent = Math.floor(gs.energy) + ' / ' + gs.maxEnergy;
            if(gs.energy < ENERGY_COST * 10) {
                energyTextEl.classList.add('energy-warning');
            } else {
                energyTextEl.classList.remove('energy-warning');
            }
        }
        if(energyFillEl) energyFillEl.style.width = (gs.energy / gs.maxEnergy * 100) + '%';
        if(coinContainer) {
            coinContainer.className = gs.energy < ENERGY_COST ? 'coin-disabled' : '';
        }
        
        // Combo
        const comboFillEl = document.getElementById('combo-fill');
        const comboTextEl = document.getElementById('combo-text');
        
        let cp = comboTimer > 0 ? (comboTimer / COMBO_TIME * 100) : 0;
        if(comboFillEl) comboFillEl.style.width = cp + '%';
        if(comboTextEl) {
            comboTextEl.style.opacity = comboTimer > 0 ? '1' : '0';
            comboTextEl.textContent = 'COMBO X' + Math.floor(combo);
        }
        
        // Collect butonu
        const collectBtn = document.getElementById('collect-btn');
        if(collectBtn) {
            let pend = pendingR();
            if(gs.collectTimer > 0){
                collectBtn.className = 'collect-btn waiting';
                collectBtn.textContent = '‚è≥ ' + fmtTime(gs.collectTimer);
            } else if(pend > 0){
                collectBtn.className = 'collect-btn';
                collectBtn.textContent = 'üí∞ ' + pend.toLocaleString() + ' ü™ô Topla';
            } else {
                collectBtn.className = 'collect-btn waiting';
                collectBtn.textContent = '‚è≥ Kart al ister misin';
            }
        }
        
        // Shop badge
        const shopBadge = document.getElementById('shop-badge');
        if(shopBadge) {
            let ownedCount = 0;
            CARDS.forEach(c => { 
                if(!c.isUpgrade && gs.cards[c.id].level > 0) ownedCount++; 
            });
            shopBadge.textContent = ownedCount;
        }
        
        // G√ºnl√ºk g√∂rev
        const questContainer = document.getElementById('quest-container');
        if(questContainer && gs.questActive && activeQuest) {
            questContainer.classList.add('active');
            
            const questProgress = document.getElementById('quest-progress');
            const questReward = document.getElementById('quest-reward');
            const questFill = document.getElementById('quest-fill');
            
            if(questProgress) questProgress.textContent = activeQuest.current + '/' + activeQuest.goal;
            if(questReward) questReward.textContent = '√ñd√ºl: ' + activeQuest.reward + ' ü™ô';
            if(questFill) questFill.style.width = (activeQuest.current / activeQuest.goal * 100) + '%';
        } else if(questContainer) {
            questContainer.classList.remove('active');
        }
        
        // Sheet a√ßƒ±ksa i√ßeriƒüi yenile
        if(sheetOpen) {
            renderContent();
        }
    }

    // ==================== SHEET Sƒ∞STEMƒ∞ ====================
    let sheetOpen = false;
    function openSheet(){
        sheetOpen = true;
        document.getElementById('sheet-overlay').classList.add('open');
        document.getElementById('sheet').classList.add('open');
        renderTabs();
        renderContent();
    }
    
    function closeSheet(){
        sheetOpen = false;
        document.getElementById('sheet-overlay').classList.remove('open');
        document.getElementById('sheet').classList.remove('open');
    }

    // ==================== EVENT LISTENERS - D√úZELTƒ∞LDƒ∞ ====================
    function initEventListeners() {
        const openShopBtn = document.getElementById('open-shop-btn');
        const sheetOverlay = document.getElementById('sheet-overlay');
        const sheetClose = document.getElementById('sheet-close');
        const coinEl = document.getElementById('coin-container');
        const collectBtn = document.getElementById('collect-btn');
        
        if(openShopBtn) openShopBtn.addEventListener('click', openSheet);
        if(sheetOverlay) sheetOverlay.addEventListener('click', closeSheet);
        if(sheetClose) sheetClose.addEventListener('click', closeSheet);
        
        if(coinEl) {
            coinEl.addEventListener('touchstart', handleTap, {passive: false});
            coinEl.addEventListener('mousedown', handleTap);
        }
        
        if(collectBtn) collectBtn.addEventListener('click', collect);
    }

    // ==================== BA≈ûLATMA ====================
    function initGame() {
        load();
        offlineCalc();
        lastLoop = Date.now();
        
        checkDailyReset();
        
        renderTabs();
        renderUI();
        checkAchievements();
        initEventListeners();
        
        // Oyun d√∂ng√ºs√º
        setInterval(gameLoop, 100);
        setInterval(save, 10000);
        
        // Debug i√ßin
        console.log('Oyun ba≈ülatƒ±ldƒ±!');
        console.log('Ba≈ülangƒ±√ß coin:', gs.score);
        console.log('Saatlik kazan√ß:', totalEarn());
    }

    // Sayfa y√ºklendiƒüinde ba≈ülat
    if(document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initGame);
    } else {
        initGame();
    }

    // Debug i√ßin global eri≈üim
    window.debugGame = {
        gs: () => gs,
        addCoins: (amount) => { 
            gs.score += amount; 
            save(); 
            renderUI(); 
            console.log(amount + ' coin eklendi. Yeni bakiye: ' + gs.score);
        },
        reset: () => { 
            if(confirm('T√ºm ilerlemen silinecek. Emin misin?')) {
                gs = defaultState(); 
                localStorage.removeItem(KEY);
                location.reload();
            }
        },
        unlockAll: () => {
            CARDS.forEach(card => {
                gs.cards[card.id].level = 10;
            });
            save();
            renderUI();
            console.log('T√ºm kartlar a√ßƒ±ldƒ±!');
        }
    };

})();
</script>
</body>
</html>
